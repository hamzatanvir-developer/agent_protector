<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AgentProtector ‚Ä¢ Org</title>
  <style>
    :root{
      --bg:#0b1220; --card:rgba(255,255,255,0.06);
      --border:rgba(255,255,255,0.12); --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.65); --link:#60a5fa; --good:#22c55e;
      --shadow:0 18px 60px rgba(0,0,0,.45); --radius:16px;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;
      --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, rgba(96,165,250,0.22), transparent 65%),
                  radial-gradient(900px 500px at 110% 20%, rgba(34,197,94,0.16), transparent 60%),
                  var(--bg);
      min-height:100vh;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:22px 18px 40px}
    .topbar{
      background:rgba(11,18,32,0.65); border-bottom:1px solid var(--border);
      backdrop-filter:blur(12px); position:sticky; top:0; z-index:10;
      margin:-22px -18px 18px; padding:14px 18px;
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
    h1{margin:0;font-size:18px}
    .sub{color:var(--muted);font-size:13px}
    .mono{font-family:var(--mono); font-size:12px; padding:4px 8px; border-radius:10px;
          background:rgba(255,255,255,0.08); border:1px solid var(--border)}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.05));
      border:1px solid var(--border); border-radius:var(--radius);
      padding:14px; box-shadow:var(--shadow);
    }
    .grid{display:grid; gap:12px; grid-template-columns:1fr 1fr}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    input{
      width:100%; padding:10px 12px; border-radius:12px; outline:none;
      border:1px solid var(--border); background:rgba(0,0,0,0.22);
      color:var(--text);
    }
    input:focus{border-color:rgba(96,165,250,0.55); box-shadow:0 0 0 4px rgba(96,165,250,0.15)}
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    .btn{
      border:0; cursor:pointer; border-radius:12px; padding:10px 12px;
      font-weight:700; font-size:13px; background:rgba(96,165,250,0.92); color:#061a2a;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn2{
      border:1px solid var(--border); cursor:pointer; border-radius:12px; padding:10px 12px;
      font-weight:700; font-size:13px; background:rgba(255,255,255,0.08); color:var(--text);
    }
    .alert{
      border:1px solid rgba(34,197,94,0.35);
      background:rgba(34,197,94,0.12);
      border-radius:var(--radius);
      padding:12px;
      margin-bottom:12px;
    }
    .pill{display:inline-flex; gap:8px; align-items:center; padding:6px 10px;
          border-radius:999px; background:rgba(255,255,255,0.08); border:1px solid var(--border);
          font-size:12px}
    .list{margin-top:10px; display:grid; gap:10px}
    .muted{color:var(--muted); font-size:13px}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="wrap">
      <div class="row">
        <div>
          <h1>Organization: {{ org.name }}</h1>
          <div class="sub">org_id: <span class="mono">{{ org.id }}</span></div>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <a class="btn2" href="/admin">‚Üê Back to Admin</a>
          <a class="btn2" href="{{ manager_console_url }}">Open Manager Console ‚Üí</a>
          <a class="btn2" href="/docs" target="_blank">Swagger</a>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">

    {% if created %}
      <div class="alert"><b>‚úÖ Organization created.</b> Now issue an agent API key below.</div>
    {% endif %}

    {% if exists %}
      <div class="alert"><b>‚ÑπÔ∏è This org already existed.</b> You can manage it here.</div>
    {% endif %}

    {% if new_agent_key %}
      <div class="alert">
        <b>‚úÖ Agent created:</b> {{ new_agent_name }} (<span class="mono">{{ new_agent_id }}</span>)<br><br>
        <b>API Key (show once):</b><br>
        <span class="mono" style="display:inline-block; margin-top:8px;">{{ new_agent_key }}</span>
        <div class="muted" style="margin-top:10px;">
          Save into <span class="mono">sdk/.env</span> as <span class="mono">AGENT_API_KEY</span>.
        </div>
      </div>
    {% endif %}

    <div class="grid">
      <div class="card">
        <h3 style="margin:0 0 8px;">Create Agent API Key</h3>
        <div class="muted" style="margin-bottom:12px;">
          This key is used by the SDK/agent via <span class="mono">X-API-Key</span>.
        </div>

        <form method="post" action="/admin/org/{{ org.id }}/agents">
          <input name="name" placeholder="Agent name (e.g. SupportBot)" required />
          <div style="margin-top:12px; display:flex; gap:10px; align-items:center;">
            <button class="btn" type="submit">üîë Create Agent Key</button>
            <span class="pill">Manager: <span class="mono">{{ manager_console_url }}</span></span>
          </div>
        </form>
      </div>

      <div class="card">
        <h3 style="margin:0 0 8px;">Agents</h3>
        <div class="muted">Keys are never shown again. Only agent metadata is listed.</div>

        <div class="list">
          {% if agents|length == 0 %}
            <div class="muted" style="margin-top:10px;">No agents yet. Create one on the left.</div>
          {% endif %}

          {% for a in agents %}
            <div class="pill" style="justify-content:space-between;">
              <div>
                <b>{{ a.name }}</b>
                <div class="muted" style="font-size:12px;">agent_id: <span class="mono">{{ a.id }}</span></div>
              </div>
              <div class="muted" style="font-size:12px;">created: {{ a.created_at }}</div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="muted" style="margin-top:16px;">
      Judge workflow: Create org ‚Üí create agent key ‚Üí put key in SDK env ‚Üí run SDK tests ‚Üí approve in Manager Console.
    </div>
  </div>
</body>
</html>
